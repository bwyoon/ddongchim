<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>Vertical Strike Arcade</title>
<style>
  body {
    background: #111;
    color: #eee;
    font-family: system-ui, -apple-system, sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }

  #game {
    position: relative;
    width: 500px;
    height: 700px;
    background: #1e1e1e;
    border: 2px solid #444;
    overflow: hidden;
  }

  #hud {
    position: absolute;
    top: 8px;
    left: 10px;
    font-size: 14px;
    z-index: 10;
  }

  #target {
    position: absolute;
    top: 60px;
    width: 80px;
    height: 40px;
    background: #4da3ff;
    border-radius: 8px;
  }

  #player {
    position: absolute;
    bottom: 20px;
    width: 60px;
    height: 30px;
    background: #9cff4d;
    border-radius: 6px;
  }

  #projectile {
    position: absolute;
    width: 6px;
    height: 20px;
    background: #ffd24d;
    display: none;
  }

  #overlay {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.75);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 12px;
    z-index: 20;
  }

  button {
    padding: 8px 16px;
    font-size: 14px;
    cursor: pointer;
  }
</style>
</head>
<body>
  <div id="game">
    <div id="hud">
      점수: <span id="score">0</span><br/>
      남은 시간: <span id="time">30.0</span>s
    </div>

    <div id="target"></div>
    <div id="player"></div>
    <div id="projectile"></div>

    <div id="overlay">
      <div>난이도 선택</div>
      <button data-speed="120">쉬움</button>
      <button data-speed="220">보통</button>
      <button data-speed="340">어려움</button>
    </div>
  </div>

<script>
(() => {
  const game = document.getElementById("game");
  const target = document.getElementById("target");
  const player = document.getElementById("player");
  const projectile = document.getElementById("projectile");
  const scoreEl = document.getElementById("score");
  const timeEl = document.getElementById("time");
  const overlay = document.getElementById("overlay");

  const W = game.clientWidth;
  const H = game.clientHeight;

  let score = 0;
  let timeLeft = 30.0;
  let running = false;

  // Target movement
  let targetX = 200;
  let targetDir = 1;
  let targetSpeed = 200; // px/sec

  // Player
  let playerX = 220;
  const playerY = H - 50;
  const playerSpeed = 300;

  // Projectile
  let firing = false;
  const travelTime = 0.2; // seconds

  function reset(speed) {
    score = 0;
    timeLeft = 30.0;
    targetSpeed = speed;
    targetX = 200;
    targetDir = 1;
    playerX = 220;
    firing = false;
    projectile.style.display = "none";
    updateHUD();
    overlay.style.display = "none";
    running = true;
  }

  function updateHUD() {
    scoreEl.textContent = score;
    timeEl.textContent = timeLeft.toFixed(1);
  }

  function rect(el) {
    return el.getBoundingClientRect();
  }

  function intersects(a, b) {
    return !(
      a.right < b.left ||
      a.left > b.right ||
      a.bottom < b.top ||
      a.top > b.bottom
    );
  }

  function fire() {
    if (firing || !running) return;
    firing = true;

    projectile.style.display = "block";
    projectile.style.left = (playerX + 27) + "px";
    projectile.style.top = playerY + "px";

    // 올라가기
    projectile.animate(
      [{ top: playerY + "px" }, { top: target.offsetTop + "px" }],
      { duration: travelTime * 1000, easing: "linear" }
    ).onfinish = () => {
      // 판정
      const hit = intersects(rect(projectile), rect(target));
      score += hit ? 1 : -1;
      updateHUD();

      // 내려오기
      projectile.animate(
        [{ top: target.offsetTop + "px" }, { top: playerY + "px" }],
        { duration: travelTime * 1000, easing: "linear" }
      ).onfinish = () => {
        projectile.style.display = "none";
        firing = false;
      };
    };
  }

  // Input
  const keys = {};
  window.addEventListener("keydown", e => {
    keys[e.code] = true;
    if (e.code === "Space") fire();
  });
  window.addEventListener("keyup", e => keys[e.code] = false);

  // Difficulty buttons
  overlay.querySelectorAll("button").forEach(btn => {
    btn.addEventListener("click", () => {
      reset(Number(btn.dataset.speed));
    });
  });

  let last = performance.now();
  function loop(now) {
    const dt = (now - last) / 1000;
    last = now;

    if (running) {
      // Timer
      timeLeft -= dt;
      if (timeLeft <= 0) {
        running = false;
        overlay.style.display = "flex";
      }
      updateHUD();

      // Target movement
      targetX += targetDir * targetSpeed * dt;
      if (targetX <= 0 || targetX + target.offsetWidth >= W) {
        targetDir *= -1;
      }
      target.style.left = targetX + "px";

      // Player movement
      if (keys["ArrowLeft"]) playerX -= playerSpeed * dt;
      if (keys["ArrowRight"]) playerX += playerSpeed * dt;
      playerX = Math.max(0, Math.min(W - player.offsetWidth, playerX));
      player.style.left = playerX + "px";
      player.style.bottom = "20px";
    }

    requestAnimationFrame(loop);
  }

  requestAnimationFrame(loop);
})();
</script>
</body>
</html>
